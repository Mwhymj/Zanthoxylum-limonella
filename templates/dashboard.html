<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏∞‡πÅ‡∏Ç‡∏ß‡πà‡∏ô</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; display: flex; height: 100vh; font-family: 'Sarabun', sans-serif; }
        .sidebar { width: 280px; background: #1b5e20; color: white; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-link { color: white; display: block; padding: 12px; text-decoration: none; margin-bottom: 8px; border-radius: 6px; transition: 0.3s; }
        .nav-link:hover { background: #2e7d32; }
        .active { background: #2e7d32; border-left: 4px solid #ffc107; }
        .admin-box { background: rgba(255, 193, 7, 0.1); border: 1px dashed #ffc107; padding: 15px; border-radius: 8px; margin-top: 20px; }
        #map { flex-grow: 1; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>üåø ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏∞‡πÅ‡∏Ç‡∏ß‡πà‡∏ô</h2>
        <p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <strong>{{ user }}</strong></p>
        <p>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: <span style="color: #ffc107;">{{ role.upper() }}</span></p>
        <hr>
        <a href="/dashboard" class="nav-link active">üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡∏£‡∏ß‡∏à</a>
        <a href="/data_table" class="nav-link">üìÅ ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢</a>

        {% if role == 'admin' %}
        <div class="admin-box">
            <p style="color: #ffc107; margin-top: 0;">üõ†Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
            <a href="#" class="nav-link" style="font-size: 14px;">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
        </div>
        {% endif %}

        <a href="/logout" class="nav-link" style="margin-top: 50px; color: #ffab91;">‚û°Ô∏è ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏õ‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ ‡∏°.‡∏û‡∏∞‡πÄ‡∏¢‡∏≤ [19.0308, 99.9263]
        var map = L.map('map').setView([19.0308, 99.9263], 15);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // ‡∏´‡∏°‡∏∏‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ ‡∏°.‡∏û‡∏∞‡πÄ‡∏¢‡∏≤ (‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á)
        L.marker([19.0308, 99.9263]).addTo(map)
            .bindPopup("<b>‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:</b> ‡∏õ‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏∞‡πÄ‡∏¢‡∏≤")
            .openPopup();

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å SQLite ‡∏°‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î
        {% for d in data %}
        L.marker([{{ d.lat }}, {{ d.lng }}]).addTo(map)
            .bindPopup(`
                <div style="text-align:center;">
                    <img src="/static/uploads/{{ d.img_name }}" width="120" style="border-radius:5px;"><br>
                    <b>‡∏ú‡∏π‡πâ‡∏™‡∏≥‡∏£‡∏ß‡∏à:</b> {{ d.surveyor }}<br>
                    <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥:</b> +/- {{ d.accuracy }} ‡πÄ‡∏°‡∏ï‡∏£<br>
                    <small>{{ d.timestamp }}</small>
                </div>
            `);
        {% endfor %}
    </script>
</body>
</html>